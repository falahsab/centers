<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¹Ø§Ù…ÙŠÙ… - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
<style>
body {
  font-family:"Tajawal",sans-serif;
  background:#0f172a;
  color:#e2e8f0;
  padding:15px;
  margin:0;
}
.container{
  max-width:700px;
  margin:auto;
  display:flex;
  flex-direction:column;
  align-items:center;
}
h2{
  text-align:center;
  color:#06b6d4;
  margin-bottom:15px;
}
input,textarea,button,select{
  width:100%;
  max-width:100%;
  margin:5px 0;
  padding:12px;
  border-radius:8px;
  border:none;
  font-size:16px;
}
textarea{resize:none;}
button{
  background:#06b6d4;
  color:white;
  cursor:pointer;
  font-weight:bold;
  transition:0.3s;
}
button:disabled{
  opacity:0.7;
  cursor:not-allowed;
}
button:hover{background:#0891b2;}
.memo{
  background:#1e293b;
  padding:15px;
  margin:10px 0;
  border-radius:10px;
  position:relative;
  width:100%;
  box-sizing:border-box;
}
.memo p{margin:5px 0;}
.memo button{
  width:auto;
  padding:5px 10px;
  margin-left:5px;
  cursor:pointer;
  font-size:14px;
}
.memo span.city{
  position:absolute;
  left:10px;
  top:10px;
  font-weight:bold;
  color:#facc15;
}
@media(max-width:480px){
  input,textarea,button,select{font-size:14px;padding:10px;}
  .memo{padding:10px;}
  .memo button{font-size:12px;padding:4px 8px;}
}
</style>
</head>
<body>
<div class="container">
  <h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„ØªØ¹Ø§Ù…ÙŠÙ…</h2>

  <!-- Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ -->
  <input type="text" id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ¹Ù…ÙŠÙ…">
  <input type="text" id="city" placeholder="Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©">
  <textarea id="content" rows="4" placeholder="Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù…ÙŠÙ…"></textarea>
  <button id="addBtn">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ù…ÙŠÙ…</button>

  <hr style="width:100%;border-color:#333;">

  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±Ø² Ø­Ø³Ø¨ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© -->
  <select id="cityFilter">
    <option value="all">ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</option>
  </select>

  <div id="memos"></div>
</div>

<script>
const SCRIPT_ID = "AKfycbzMcjE-lMKfbYZH1QeKYfWwbU1VykSH3y6Lgk6ixWCI9eMuOavqzOzKegkpa-Udm5b8";
const API_URL = `https://script.google.com/macros/s/${SCRIPT_ID}/exec`;

const $ = s=>document.querySelector(s);

let allMemos = [];
let editingID = null;
const titleColors = ['#f87171','#60a5fa','#34d399','#facc15','#a78bfa','#f472b6'];

// Ø¬Ù„Ø¨ Ø§Ù„ØªØ¹Ø§Ù…ÙŠÙ…
async function fetchMemos(){
  try{
    const res = await fetch(API_URL);
    const memos = await res.json();
    allMemos = memos.filter(m=> m.Status!=='Deleted');
    populateCities();
    renderMemos($('#cityFilter').value);
  }catch(err){
    console.error(err);
    $('#memos').innerHTML = `<p>âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„ØªØ¹Ø§Ù…ÙŠÙ…</p>`;
  }
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©
function renderMemos(city){
  const container = $('#memos');
  container.innerHTML = '';
  const memosToShow = city==='all' ? allMemos : allMemos.filter(m=> m.City===city);
  memosToShow.forEach((m,i)=>{
    const color = titleColors[i % titleColors.length];
    container.innerHTML += `
      <div class="memo" id="memo-${m.ID}">
        <span class="city">${m.City}</span>
        <b style="color:${color}">${m.Title}</b> (${m.Date})<br>
        <p>${m.Content}</p>
        <button onclick="editMemo('${m.ID}','${m.Title}','${m.City}','${m.Content}')">ØªØ¹Ø¯ÙŠÙ„</button>
        <button onclick="deleteMemo('${m.ID}')">Ø­Ø°Ù</button>
      </div>`;
  });
}

// Ù…Ù„Ø£ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª
function populateCities(){
  const select = $('#cityFilter');
  // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù…Ø§ Ø¹Ø¯Ø§ "ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª"
  select.querySelectorAll('option:not([value="all"])').forEach(o=>o.remove());
  const cities = [...new Set(allMemos.map(m=>m.City))];
  cities.forEach(c=>{
    const option = document.createElement('option');
    option.value = c;
    option.textContent = c;
    select.appendChild(option);
  });
}

// Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ù…ÙŠÙ…
async function addMemo(){
  const title = $('#title').value.trim();
  const city = $('#city').value.trim();
  const content = $('#content').value.trim();
  if(!title || !content || !city){ alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„'); return; }
  const date = new Date().toLocaleDateString();
  const ID = Date.now();

  $('#addBtn').disabled = true;
  $('#addBtn').innerText = 'ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©...';
  await fetch(API_URL,{method:'POST',body: JSON.stringify({action:'add', ID, Title:title, City:city, Content:content, Date:date})});
  $('#title').value=''; $('#city').value=''; $('#content').value='';
  $('#addBtn').disabled = false;
  $('#addBtn').innerText = 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ù…ÙŠÙ…';
  fetchMemos();
}

// Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
async function saveEdit(){
  const title = $('#title').value.trim();
  const city = $('#city').value.trim();
  const content = $('#content').value.trim();
  if(!title || !content || !city){ alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„'); return; }
  const date = new Date().toLocaleDateString();

  $('#addBtn').disabled = true;
  $('#addBtn').innerText = 'ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
  await fetch(API_URL,{method:'POST',body: JSON.stringify({action:'edit', ID:editingID, Title:title, City:city, Content:content, Date:date})});

  editingID = null;
  $('#title').value=''; $('#city').value=''; $('#content').value='';
  $('#addBtn').disabled = false;
  $('#addBtn').innerText = 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ù…ÙŠÙ…';
  $('#addBtn').onclick = addMemo;
  fetchMemos();
}

// ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
function editMemo(ID, title, city, content){
  $('#title').value = title;
  $('#city').value = city;
  $('#content').value = content;
  editingID = ID;
  $('#addBtn').innerText = 'ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„';
  $('#addBtn').onclick = saveEdit;
}

// Ø­Ø°Ù Ø§Ù„ØªØ¹Ù…ÙŠÙ…
async function deleteMemo(ID){
  if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ¹Ù…ÙŠÙ…ØŸ')){
    await fetch(API_URL,{method:'POST',body: JSON.stringify({action:'delete', ID})});
    fetchMemos();
  }
}

// ØªØºÙŠÙŠØ± Ø§Ù„ÙØ±Ø² Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©
$('#cityFilter').addEventListener('change', e=>{
  renderMemos(e.target.value);
});

$('#addBtn').onclick = addMemo;
fetchMemos();
</script>
</body>
</html>
