<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<title>Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø£ÙˆØ±Ø§Ù‚ Google Sheets</title>
<style>
body { font-family: "Tajawal", sans-serif; background:#f7f8fa; text-align:center; padding:20px; }
input { width:90%; max-width:400px; padding:10px; font-size:18px; border:1px solid #ccc; border-radius:8px; margin-bottom:15px; }
.result { background:#fff; border:1px solid #ddd; border-radius:10px; margin:10px auto; padding:10px; max-width:400px; text-align:right; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
.name { font-weight:bold; color:#007bff; }
.sheet-label { font-size:13px; color:#555; margin-bottom:4px; }
</style>
</head>
<body>

<h2>ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙÙŠ ÙƒÙ„ Ø£ÙˆØ±Ø§Ù‚ Google Sheet</h2>
<input type="text" id="search" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„...">
<div id="output">â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>

<script>
const sheetId = "1QrQejijDXc_8WzzMVi7IvrWOuGpxXjLkUlleTGuj1NM";
let rows = [];

// 1ï¸âƒ£ Ù†Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø´ÙŠØª
fetch(`https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json`)
  .then(res => res.text())
  .then(txt => {
    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ Ù…Ù† Ø§Ù„Ù†Øµ
    const matches = [...txt.matchAll(/"table":{"cols":.*?,"parsedNumHeaders":\d+},"status":"ok"}],"version":".*?","sig":".*?","reqId":"\d+","table":{"cols":/g)];
    // Ù‡Ø°Ù‡ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ù…Ø¹Ù‚Ø¯Ø© Ù‚Ù„ÙŠÙ„Ù‹Ø§ Ù„Ø£Ù† Google Ù„Ø§ ÙŠÙˆÙØ± API Ù…Ø¨Ø§Ø´Ø± Ø¨Ø¯ÙˆÙ† Ù…ÙØªØ§Ø­
    // Ù„Ø°Ø§ Ø³Ù†Ø³ØªØ®Ø¯Ù… Ù†Ù‡Ø¬ Ø£Ø¨Ø³Ø· (Ù…Ø¨Ù†ÙŠ Ø¹Ù„Ù‰ Ø§Ù„ØªØ®Ù…ÙŠÙ† Ø§Ù„ÙŠØ¯ÙˆÙŠ Ø¥Ù† Ø¹Ø±ÙØª Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚)
    // âœ³ï¸ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ù‡Ø°Ø§: Ø¶Ø¹ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ Ù‡Ù†Ø§ ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ø¥Ø°Ø§ Ù„Ù… ØªØ¸Ù‡Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§:
    const sheetNames = ["Sheet1", "Sheet2", "Sheet3"]; // â† ØºÙŠÙ‘Ø±Ù‡Ø§ Ø­Ø³Ø¨ Ø£ÙˆØ±Ø§Ù‚Ùƒ
    
    Promise.all(sheetNames.map(name => loadSheet(sheetId, name)))
      .then(() => {
        document.getElementById("output").innerHTML = `âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${rows.length} ØµÙ Ù…Ù† ${sheetNames.length} Ø£ÙˆØ±Ø§Ù‚`;
      })
      .catch(err => {
        document.getElementById("output").innerHTML = "âš ï¸ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„: " + err;
      });
  });

// 2ï¸âƒ£ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ±Ù‚Ø© Ø¨ØµÙŠØºØ© CSV
function loadSheet(sheetId, sheetName) {
  const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheetName)}`;
  return fetch(url)
    .then(res => res.text())
    .then(csv => {
      const lines = csv.trim().split(/\r?\n/);
      const headers = lines[0].replace(/"/g,"").split(",");
      for (let i = 1; i < lines.length; i++) {
        const values = lines[i].replace(/"/g,"").split(",");
        const obj = {};
        headers.forEach((h, j) => obj[h] = values[j]);
        obj.sheet = sheetName; // Ù†Ø¶ÙŠÙ Ø§Ø³Ù… Ø§Ù„ÙˆØ±Ù‚Ø©
        rows.push(obj);
      }
    });
}

// 3ï¸âƒ£ Ø§Ù„Ø¨Ø­Ø« Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø©
document.getElementById("search").addEventListener("input", function() {
  const k = this.value.trim().toLowerCase();
  const out = document.getElementById("output");

  if (k === "") { out.innerHTML = ""; return; }

  const matches = rows.filter(r => 
    (r.name && r.name.toLowerCase().includes(k)) ||
    (r.mob && r.mob.includes(k))
  );

  if (matches.length > 0) {
    out.innerHTML = matches.map(s => `
      <div class="result">
        <div class="sheet-label">ğŸ“„ Ù…Ù† Ø§Ù„ÙˆØ±Ù‚Ø©: ${s.sheet}</div>
        <div class="name">ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${s.name}</div>
        <div>ğŸ“± Ø§Ù„Ø¬ÙˆØ§Ù„: ${s.mob}</div>
        <div>ğŸ”¢ Ø±Ù‚Ù… Ø§Ù„Ø­ÙˆØ§Ù„Ø©: ${s.num}</div>
        <div>ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº: ${s.deger}</div>
      </div>
    `).join("");
  } else {
    out.innerHTML = "âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©";
  }
});
</script>
</body>
</html>
