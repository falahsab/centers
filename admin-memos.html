<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¹Ø§Ù…ÙŠÙ…</title>
<style>
body{font-family:"Tajawal",sans-serif;background:#0f172a;color:#e2e8f0;padding:15px;}
.container{max-width:600px;margin:auto;}
h2{text-align:center;color:#06b6d4;}
input,textarea,button{width:100%;margin:5px 0;padding:10px;border-radius:6px;border:none;}
textarea{resize:none;}
button{background:#06b6d4;color:white;cursor:pointer;font-weight:bold;}
button:disabled{opacity:0.7;cursor:not-allowed;}
.memo{background:#1e293b;padding:10px;margin:10px 0;border-radius:8px;}
.memo p{margin:5px 0;}
.memo button{width:auto;padding:5px 10px;margin-left:5px;}
</style>
</head>
<body>
<div class="container">
  <h2>Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¹Ø§Ù…ÙŠÙ…</h2>
  <input type="text" id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ¹Ù…ÙŠÙ…">
  <textarea id="content" rows="3" placeholder="Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù…ÙŠÙ…"></textarea>
  <button id="addBtn">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ù…ÙŠÙ…</button>
  <hr>
  <div id="memos"></div>
</div>

<script>
const SCRIPT_ID = "AKfycbwZvptN5ADftcmgTykOBTGV1s4zBASbU6R37w8TyeuJOMY4KtwgoRfjs3RELJEYndYj";
const API_URL = `https://script.google.com/macros/s/${SCRIPT_ID}/exec`;

const $ = s=>document.querySelector(s);
const $$ = s=>document.querySelectorAll(s);

async function fetchMemos(){
  const res = await fetch(API_URL);
  const memos = await res.json();
  const container = $('#memos');
  container.innerHTML = '';
  memos.forEach(m=>{
    if(m.Status!=='Deleted'){
      container.innerHTML += `
      <div class="memo" id="memo-${m.ID}">
        <b>${m.Title}</b> (${m.Date})<br>
        <p>${m.Content}</p>
        <button onclick="editMemo('${m.ID}')">ØªØ¹Ø¯ÙŠÙ„</button>
        <button onclick="deleteMemo('${m.ID}')">Ø­Ø°Ù</button>
      </div>`;
    }
  });
}

async function addMemo(){
  const title = $('#title').value.trim();
  const content = $('#content').value.trim();
  if(!title || !content){ alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰'); return; }
  const date = new Date().toLocaleDateString();
  const ID = Date.now(); // Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯
  $('#addBtn').disabled = true;
  $('#addBtn').innerText = 'ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©...';
  await fetch(API_URL,{
    method:'POST',
    body: JSON.stringify({action:'add', ID, Title:title, Content:content, Date:date})
  });
  $('#title').value=''; $('#content').value='';
  $('#addBtn').disabled = false;
  $('#addBtn').innerText = 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ù…ÙŠÙ…';
  fetchMemos();
}

async function editMemo(ID){
  const memo = document.getElementById(`memo-${ID}`);
  const title = prompt('Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', memo.querySelector('b').innerText);
  const content = prompt('Ø¹Ø¯Ù„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰', memo.querySelector('p').innerText);
  if(title && content){
    const date = new Date().toLocaleDateString();
    await fetch(API_URL,{
      method:'POST',
      body: JSON.stringify({action:'edit', ID, Title:title, Content:content, Date:date})
    });
    fetchMemos();
  }
}

async function deleteMemo(ID){
  if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ¹Ù…ÙŠÙ…ØŸ')){
    await fetch(API_URL,{
      method:'POST',
      body: JSON.stringify({action:'delete', ID})
    });
    fetchMemos();
  }
}

$('#addBtn').onclick = addMemo;
fetchMemos();
</script>
</body>
</html>
